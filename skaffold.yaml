apiVersion: skaffold/v2beta13
kind: Config
metadata:
  name: bookinfo
build:
  local:
    push: true
  artifacts:
    - image: ghcr.io/ammerzon/bookinfo-details-v1
      context: src/details
      docker:
        dockerfile: Dockerfile
    - image: ghcr.io/ammerzon/bookinfo-productpage-v1
      context: src/productpage
      docker:
        dockerfile: Dockerfile
    - image: ghcr.io/ammerzon/bookinfo-ratings-v2
      context: src/ratings
      docker:
        dockerfile: Dockerfile
        buildArgs:
          service_version: v2
    - image: ghcr.io/ammerzon/bookinfo-ratings-admin-v1
      context: src/ratings-admin
      docker:
        dockerfile: src/main/docker/Dockerfile.native
    - image: ghcr.io/ammerzon/bookinfo-reviews-v1
      context: src/reviews/reviews-wlpcfg
      docker:
        dockerfile: Dockerfile
        buildArgs:
          service_version: v1
    - image: ghcr.io/ammerzon/bookinfo-reviews-v2
      context: src/reviews/reviews-wlpcfg
      docker:
        dockerfile: Dockerfile
        buildArgs:
          service_version: v2
          enable_ratings: true
    - image: ghcr.io/ammerzon/bookinfo-reviews-v3
      context: src/reviews/reviews-wlpcfg
      docker:
        dockerfile: Dockerfile
        buildArgs:
          service_version: v3
          enable_ratings: true
          star_color: red
    - image: ghcr.io/ammerzon/bookinfo-mongodb
      context: src/mongodb
      docker:
        dockerfile: Dockerfile
deploy:
  kubectl:
    manifests:
      - platform/bookinfo.yaml
      - platform/bookinfo-db.yaml